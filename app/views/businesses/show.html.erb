<h1> <%= @business.name %> </h1>
<p> <%= @business.address %></p>
<p> <%= @business.city %></p>
<p> <%= @business.state %></p>
<p> <%= @business.description %></p>
<p> <%= link_to 'Edit this business', edit_business_path %></p>

<p>Total Reviews: <%= @reviews.count %></p>
<%= link_to 'Add a review', new_business_review_path(@business) %>
<div class="social">
<% if current_user.likes?(@business) %>
  <%= button_to "UNLIKE this business", business_unlike_path(@business), remote: :true, method: :post, class: "social-like" %>
<% else %>
  <%= button_to "like this business", business_like_path(@business), remote: :true, method: :post, class: "social-unlike" %>
<% end %>
</div>

<p class="likes-count">
  <%= pluralize(@business.likers(User).count, 'Like') %>
</p>

<!--TODO remove this ruby validation after removing records without userid-->
<% @reviews.each do |r| %>
    <% unless !r.user_id %>
        <p><strong><%= r.title %></strong></p>
        <p><%= r.description %></p>
        <p>Rating: <%= r.rating %></p>
        <p>
          Reviewed by: <% u = User.find(r.user_id) %>
            <%= image_tag u.avatar.url(:thumb), style: "height: 100px;" %>
            <%= link_to u.given_name, user_path(u) %>,
            <%= time_ago_in_words(r.created_at) %> ago.
            <% if current_user.id == u.id %>
              <%= link_to '[X]', business_review_path(@business.id, r.id), method: :delete %>
            <% end %>
        </p>
    <% end %>
<% end %>
